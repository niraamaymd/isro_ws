<launch>
  <!-- RealSense D435i -->
  <include file="$(find realsense2_camera)/launch/rs_camera.launch">
    <arg name="align_depth"          value="true"/>
    <arg name="depth_width"          value="640"/>
    <arg name="depth_height"         value="480"/>
    <arg name="color_width"          value="640"/>
    <arg name="color_height"         value="480"/>
    <arg name="depth_fps"            value="15"/>
    <arg name="color_fps"            value="15"/>
    <arg name="unite_imu_method"     value="linear_interpolation"/>
    <arg name="gyro_fps"             value="200"/>
    <arg name="accel_fps"            value="200"/>
  </include>

  <!-- IMU Filter (Madgwick) -->
  <node pkg="imu_filter_madgwick" type="imu_filter_node" name="imu_filter" output="screen">
    <param name="use_mag"            value="false"/> <!-- D435i has no magnetometer -->
    <param name="publish_tf"         value="false"/> <!-- RTAB-Map handles TF -->
    <param name="world_frame"        value="enu"/>   <!-- Coordinate frame: enu/ned -->
    <remap from="/imu/data_raw"       to="/camera/imu"/>
    <remap from="/imu/data"           to="/rtabmap/imu"/>
  </node>

  <!-- RTAB-Map -->
  <include file="$(find rtabmap_ros)/launch/rtabmap.launch">
      <!--<arg name="cfg" value="$(find rtabmap_ros)/launch/config/realsense.ini" />-->
      <arg name="frame_id"             value="camera_link"/>
      <arg name="rgb_topic"            value="/camera/color/image_raw"/>
      <arg name="depth_topic"          value="/camera/aligned_depth_to_color/image_raw"/>
      <arg name="imu_topic"            value="/camera/imu/filtered"/> <!-- Filtered IMU -->
      <arg name="camera_info_topic"    value="/camera/color/camera_info"/>
      <arg name="approx_sync"          value="true"/>
      <arg name="queue_size"           value="5"/>
      <arg name="rtabmapviz"           value="false"/>
      <arg name="rviz"                 value="true"/>
      <arg name="wait_imu_to_init"     value="true"/>

      <param name="Odom/Strategy" value="2"/>

  </include>
</launch>
